(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{"2QHJ":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},n=function(){function e(e,t){for(var i=0;t.length>i;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=i("uki+"),o=(a=s)&&a.__esModule?a:{default:a},l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("RjO+"));function c(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);e.length>t;t++)i[t]=e[t];return i}return Array.from(e)}var d=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loaded=!1,this.fullDataLoaded=!1,this.timestamps=[],this.prices=[],this.minPrice=1e6,this.maxPrice=0,this.isModal=!1,this.zoomResetFnc=!1,this.boundControls=!1,this.defaultAge=31,this.fullAge=9999,this._createTooltip=function(e){var i=t.mountEl.querySelectorAll(".ct-series-a .ct-point"),a=void 0;if(!(!e.target.className.baseVal||"ct-point"!==e.target.className.baseVal&&"ct-chart-line"!==e.target.className.baseVal||e.target.parentNode.className.baseVal&&-1!==e.target.parentNode.className.baseVal.indexOf("series-b"))){if(e.target.className.baseVal&&"ct-point"===e.target.className.baseVal){for(var r=0;i.length>r;r++)i[r].style.opacity=0;a=e.target}else for(var n=void 0,s=0;i.length>s;s++){i[s].style.opacity=0;var o=e.clientX-e.target.getBoundingClientRect().left-i[s].getAttribute("x2");n&&(-o>0?-o:o)>=n||(n=o,a=i[s])}var l=void 0,c=void 0;if(t.isModal){var d=(c=a.getAttribute("ct:value")).lastIndexOf(","),u=[c.slice(0,d),c.slice(d+1)],h=new Date(+u[0]);l=t._getFormattedDate(h),c=u[1]}else l=a.getAttribute("ct:meta"),c=a.getAttribute("ct:value");var p=document.querySelector("#"+t.mount+"-tooltip"),g=document.querySelector("#"+t.mount+"-indicator");if(!c||!l)return p.classList.add("hide"),void g.classList.add("hide");var m=a.getAttribute("x2")-p.offsetWidth/2,f=a.getAttribute("y2")-p.offsetHeight-20;p.style.left=m+"px",p.style.top=f+"px",p.classList.contains("hide")&&(p.classList.remove("hide"),g.classList.remove("hide")),p.innerHTML='<div class="chartist-tooltip__price">'+("en"===t.lang?Number(c).toFixed(2):Number(c).toFixed(2).replace(".",","))+" "+t.currency+'</div><div class="chartist-tooltip__date">'+l+"</div>";var v=t.mountEl.querySelectorAll(".ct-grids")[0].getBoundingClientRect(),y=t.mountEl.getBoundingClientRect().top-v.top;g.style.height=v.height+"px",g.style.left=a.getAttribute("x2")+"px",g.style.top=(-y>0?-y:y)+"px",a.style.opacity=1}},this._onZoom=function(e,i){t.resetbtn.classList.remove("gh-basic__button--invisible"),t.zoomResetFnc||(t.zoomResetFnc=i),window.ga&&ga("send","event","Price history","Click","Zoom")},this._resetZoom=function(){t.zoomResetFnc&&t.zoomResetFnc(),t.zoomResetFnc=void 0,t.resetbtn.classList.add("gh-basic__button--invisible")},this._getFormattedDate=function(e){return t.dateFormat.replace("%d",e.getDate()).replace("%m",e.getMonth()+1).replace("%Y",e.getFullYear())}}return n(e,[{key:"init",value:function(e,t,a,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.defaultAge,s=arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"EUR",c=this,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"%d.%m.%Y",u=arguments[9];this._injectStyles(),this.mountEl=document.querySelector("#"+a),this.dataEl=document.querySelector("#"+r),this.loadingEl=document.querySelector("#"+r),this.controlsWrapper=document.querySelector("#"+a+"__controls"),this.controls=this.controlsWrapper.querySelectorAll("."+a+"__control"),s&&(this.resetbtn=document.querySelector("#pricehistory-resetbtn"),this.resetbtn.classList.add("gh-basic__button--invisible"),this.resetbtn.addEventListener("click",this._resetZoom),this.unfilteredBestprice=document.querySelector("#unfiltered_bestprice")),this.bestprice=+t,this.id=e,this.mount=a,this.dataMount=r,this.isModal=s,this.age=this.isModal&&window._gh_storage.priceHistoryTimerangeOverride?window._gh_storage.priceHistoryTimerangeOverride:n,this.listedSince=o,this.lang=u,this.dateFormat=d,this.currency=this._currencyCaption(l);var h=[];Array.from||h.push(i.e(2).then(i.t.bind(null,"201c",7))),this.isModal&&h.push(i.e(36).then(i.t.bind(null,"xAWw",7))),Promise.all(h).then(function(){c._loadAndDrawData(),c._stopLoading()})}},{key:"_injectStyles",value:function(){if(!document.querySelector("#chartist-styles")){var e=document.createElement("style");e.innerHTML=l.default.toString(),e.id="#chartist-styles",document.head.appendChild(e)}}},{key:"_loadAndDrawData",value:function(){var e=this,t=this.age!==this.defaultAge;if(window._gh_storage.priceHistoryData){var i=this._getDataForRange(window._gh_storage.priceHistoryData,this.age);i&&(this._drawChart(i),this._createControls())}else{var a=window.location.href.replace(/\/[^\/]+$/,"/")+"?phist="+this.id+"&tableonly=1&age="+(t?this.fullAge:this.defaultAge);this._startLoading(),window._gh.ajax.load(a,function(i){e.dataEl.innerHTML=i,e.data=e._jsonFromDomNode(".product__pricehistory-data")||[],e.options=e._jsonFromDomNode(".product__pricehistory-options")||{};var a=e._getDataForRange(e._prepareDataForGraph(t),e.age);if(a&&(e._drawChart(a),e._createControls()),void 0!==e.options.unfiltered_bestprice&&(window.ufbp=e.options.unfiltered_bestprice,document.getElementById("unfiltered_bestprice_value").innerHTML=window.ufbp),window._gh_storage.priceHistoryData&&(window.fp=window._gh_storage.priceHistoryData.prices.modal[0].y,window.fpp=Math.round(100*Math.abs(100-e.bestprice/window.fp*100))/100,window.fpp>0)){var r=e.bestprice>window.fp?"+":"-",n=document.querySelector(".pricechart_firstprice_infotext");n&&(n.innerHTML=n.innerHTML.replace(/\$\$fpp/g,"<span class='chart_firstprice_percent"+("+"==r?"_gt0":"_lt0")+"'>"+r+e._formatPrice(window.fpp.toFixed(2),".00")+"%</span>"),n.innerHTML=n.innerHTML.replace(/\$\$fp/g,"<b>"+e.currency+" "+e._formatPrice((window.fp||0).toFixed(2)+"")+"</b>"),n.style.display="inline")}})}}},{key:"_jsonFromDomNode",value:function(e){try{return JSON.parse(this.dataEl.querySelector(e).innerText)}catch(e){return!1}}},{key:"_prepareDataForGraph",value:function(e){var t=this,i={modal:[],preview:[]},a=[],r=this.data.filter(function(e){return!(!e.length||!e[0]||isNaN(e[0])||!e[1]||isNaN(e[1]))});if(r.length){r.map(function(e){a.push(e[0]);var r=new Date(e[0]);i.modal.push({x:r.getTime(),y:e[1]}),i.preview.push({meta:t._getFormattedDate(r),value:e[1]}),e[1]>t.maxPrice&&(t.maxPrice=e[1]),t.minPrice>e[1]&&(t.minPrice=e[1])});var n={prices:i,timestamps:a};return e&&(window._gh_storage.priceHistoryData=n),n}this.mountEl.classList.add("nodata")}},{key:"_getDataForRange",value:function(e,t){if(e){var i=this.isModal?e.prices.modal:e.prices.preview;return{timestamps:e.timestamps.slice(-t),prices:i.slice(-t)}}}},{key:"_currencyCaption",value:function(e){switch(e){case"EUR":return"€";case"GBP":return"£";default:return e}}},{key:"_drawChart",value:function(e){var t=this,i=e.timestamps,a=e.prices,n={labels:[i],series:this.isModal&&this.bestprice?[{data:a},{name:"bestprice",data:[{x:i[i.length-1],y:this.bestprice}]}]:[{data:a}]},s=this._getOptions(n);new o.default.Line("#"+this.mount,n,s).on("draw",function(e){if("line"===e.type&&1!==e.seriesIndex&&(t.mountEl.addEventListener("mousemove",t._createTooltip),!t.isModal)){var i=e.path.pathElements.reduce(function(e,t,i){return 0===i?r({},e,{min:{y:t.y,value:t.data.value.y},max:{y:t.y,value:t.data.value.y}}):e.min.value>t.data.value.y?r({},e,{min:{y:t.y,value:t.data.value.y}}):t.data.value.y>e.max.value?r({},e,{max:{y:t.y,value:t.data.value.y}}):e},{min:{y:0,value:1e5},max:{y:0,value:0}}),a=i.min,n=i.max,s=t.mountEl.offsetWidth,o={max:n.y,min:a.y},l=a.y-n.y;16>l&&0!==l&&(o.max=o.max-(16-l)/2,o.min=o.min+(16-l)/2),e.group.elem("text",{x:s,y:o.max+4},"ct-label ct-vertical ct-end ct-lastdate").text(t.currency+" "+Math.round(n.value)),n.value!==a.value&&e.group.elem("text",{x:s,y:o.min+4},"ct-label ct-vertical ct-end ct-lastdate").text(t.currency+" "+Math.round(a.value))}})}},{key:"_compareWithBestprice",value:function(){if(this.unfilteredBestprice&&this.bestprice&&prices[prices.length-1].y>=this.bestprice){prices[prices.length-1].y=this.bestprice;var e=this._formatPrice(""+this.bestprice);this.unfilteredBestprice.innerText=this.currency+" "+e}}},{key:"_formatPrice",value:function(e,t){var i=t||".--";return"en"===this.lang?(e.replace(".00",i),-1===e.indexOf(".")&&(e+=i)):(i=i.replace(".",","),-1===(e=e.replace(".",",").replace(",00",i)).indexOf(",")&&(e+=i)),e}},{key:"_getMinMax",value:function(e){var t=this.isModal?"y":"value",i=e.series[0].data.reduce(function(e,i,a){return 0===a?r({},e,{min:i[t],max:i[t]}):e.min>i[t]?r({},e,{min:i[t]}):i[t]>e.max?r({},e,{max:i[t]}):e},{min:1e5,max:0});return{min:i.min,max:i.max}}},{key:"_getOptions",value:function(e){var t=this,i=[],a=this._getMinMax(e),n=a.min,s=a.max,l=this._getYAxisLabelPadding(n,s),c=this._getYAxisBoundaries(n,s),d={height:"100%",fullWidth:!0,chartPadding:{top:8,right:l},lineSmooth:o.default.Interpolation.simple({divisor:1,fillHoles:!1}),axisX:{offset:0,showGrid:!1,showLabel:!1},axisY:r({onlyInteger:!0,showLabel:!1,showGrid:!0,position:"end"},c),plugins:i};return this.isModal?(d=r({},d,{chartPadding:{right:this.currency&&this.currency.length>1?l:0,left:0},axisX:{type:o.default.AutoScaleAxis,showGrid:!1,showLabel:!0,labelInterpolationFnc:function(e,i,a){if(-1!==[0,Math.round(a.length/6),Math.round(a.length/3),Math.round(a.length/2),Math.round(a.length/3*2),Math.round(a.length/6*5),a.length-1].indexOf(i)){var r=new Date(e);return t._getFormattedDate(r)}}},axisY:r({type:o.default.AutoScaleAxis,onlyInteger:!0,showLabel:!0,showGrid:!0,position:"end",labelInterpolationFnc:function(e){return t.currency+" "+e}},c),series:{bestprice:{showPoint:!0}}}),i.push(o.default.plugins.zoom({onZoom:this._onZoom})),d):d}},{key:"_getYAxisLabelPadding",value:function(e,t){var i=this.currency&&this.currency.length>1?this.currency.length:0,a=(Math.round(e)+"").length+i,r=(Math.round(t)+"").length+i;return a>r&&(r=a),r&&r>3?(r>4&&(r*=2),r+5):0}},{key:"_getYAxisBoundaries",value:function(e,t){var i=e===t||1>t-e;if(this.isModal||i){var a=i?.5:.1;return{high:t+a,low:e-a}}var r={};this.isModal&&(r.high=t+.1,r.low=e-.1);var n=100*e/t;if(n>90&&(this.isModal||!this.isModal&&99.8>n)){var s=1;this.isModal||(n>99.6?s=20:n>99.4?s=18:n>99.2?s=12:n>99?s=10:n>98.8?s=7:n>98.5?s=6:n>98?s=5:n>97?s=4:n>96?s=3:n>95&&(s=2));var o=(100-n)*s+90;if(o>100&&(o=100),r.high=t*(100/o),r.low=e*(o/100),r.low>r.high)return{}}return r}},{key:"_createControls",value:function(){var e=this,t=this.isModal?0:1;this.controls&&!this.boundControls&&([].concat(c(this.controls)).map(function(i){var a=i.getAttribute("data-range"),r=function(){if(e.isModal||(window._gh_storage.priceHistoryTimerangeOverride=a),"all"===a)e._drawChart(e._getDataForRange(window._gh_storage.priceHistoryData,9999));else if(window._gh_storage.fullPriceHistory||e.isModal){var t=e._getDataForRange(window._gh_storage.priceHistoryData,a);t&&e._drawChart(t)}else e.init(e.id,e.bestprice,e.mount,e.dataMount,a,!1,e.listedSince,e.currency,e.dateFormat,e.lang);[].concat(c(e.controls)).map(function(e){return e.classList.remove("active")}),i.classList.add("active"),e.isModal&&e.zoomResetFnc&&e.resetZoom()};e.isModal&&window._gh_storage.priceHistoryTimerangeOverride&&[].concat(c(e.controls)).map(function(e){return window._gh_storage.priceHistoryTimerangeOverride+""===e.getAttribute("data-range")?e.classList.add("active"):e.classList.remove("active")}),"all"!==a&&(e.isModal&&window._gh_storage.priceHistoryData.timestamps.length<a||!e.isModal&&a>e.listedSince)?(i.classList.add("hide"),i.addEventListener("click",r)):(i.addEventListener("click",r),t++)}),t>1&&this.controlsWrapper.classList.remove("hide"),this.boundControls=!0)}},{key:"_startLoading",value:function(){this.isModal?_gh.modal.startLoading("modal-"+this.mount):this.mountEl.classList.remove("loaded")}},{key:"_stopLoading",value:function(){this.isModal?_gh.modal.stopLoading("modal-"+this.mount):this.mountEl.classList.add("loaded")}}]),e}();t.default=d}}]);